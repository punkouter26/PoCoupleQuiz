@page "/leaderboard"
@using PoCoupleQuiz.Core.Models
@using PoCoupleQuiz.Core.Services
@inject IAzureTableTeamService TeamService

<h3>Top 10 Teams Leaderboard</h3>

<div class="container mt-4">
    @if (_teams == null)
    {
        <p>Loading...</p>
    }
    else if (!_teams.Any())
    {
        <p>No teams have played yet!</p>
    }
    else
    {
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Team Name</th>
                        <th>Correct %</th>
                        <th>Questions Answered</th>
                        <th>Correct Answers</th>
                        <th>Last Played</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        var rank = 1;
                        foreach (var team in _teams)
                        {
                            <tr>
                                <td>@rank</td>
                                <td>@team.Name</td>
                                <td>@team.CorrectPercentage.ToString("F1")%</td>
                                <td>@team.TotalQuestionsAnswered</td>
                                <td>@team.CorrectAnswers</td>
                                <td>@team.LastPlayed.ToLocalTime().ToString("g")</td>
                            </tr>
                            rank++;
                        }
                    }
                </tbody>
            </table>
        </div>
    }
</div>

@code {
    private IEnumerable<Team>? _teams;

    protected override async Task OnInitializedAsync()
    {
        var allTeams = await TeamService.GetAllTeamsAsync();
        _teams = allTeams
            .Where(t => t.TotalQuestionsAnswered > 0)
            .OrderByDescending(t => t.CorrectPercentage)
            .ThenByDescending(t => t.TotalQuestionsAnswered)
            .Take(10)
            .ToList();
    }
} 
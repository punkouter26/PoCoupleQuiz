@inject IJSRuntime JS

@if (IsVisible)
{
    <div class="celebration-overlay">
        <div class="confetti-container" @ref="confettiContainer">
            @for (int i = 0; i < 50; i++)
            {
                <div class="confetti" style="left: @(Random.Shared.Next(0, 100))%; animation-delay: @(Random.Shared.Next(0, 300))ms; background-color: @GetRandomColor();"></div>
            }
        </div>
        
        <div class="celebration-message">
            <div class="celebration-icon">@Icon</div>
            <h2 class="celebration-title">@Title</h2>
            <p class="celebration-subtitle">@Message</p>
        </div>
    </div>
}

@code {
    [Parameter]
    public bool IsVisible { get; set; }

    [Parameter]
    public string Icon { get; set; } = "ðŸŽ‰";

    [Parameter]
    public string Title { get; set; } = "Perfect Match!";

    [Parameter]
    public string Message { get; set; } = "You know each other so well!";

    [Parameter]
    public EventCallback OnComplete { get; set; }

    private ElementReference confettiContainer;

    private string[] colors = new[] { "#FF6B6B", "#4ECDC4", "#45B7D1", "#FFA07A", "#98D8C8", "#F7DC6F", "#BB8FCE", "#85C1E2" };

    private string GetRandomColor()
    {
        return colors[Random.Shared.Next(colors.Length)];
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (IsVisible)
        {
            // Play sound if enabled
            try
            {
                await JS.InvokeVoidAsync("playSuccessSound");
            }
            catch { }

            // Trigger haptic feedback on mobile
            try
            {
                await JS.InvokeVoidAsync("triggerHapticFeedback");
            }
            catch { }

            // Auto-hide after 3 seconds
            await Task.Delay(3000);
            if (OnComplete.HasDelegate)
            {
                await OnComplete.InvokeAsync();
            }
        }
    }
}

<script>
    window.playSuccessSound = function() {
        // Create a simple beep using Web Audio API
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 800;
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.5);
    };

    window.triggerHapticFeedback = function() {
        if ('vibrate' in navigator) {
            navigator.vibrate([50, 30, 50, 30, 50]);
        }
    };
</script>

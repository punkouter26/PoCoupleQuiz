@page "/leaderboard"
@using PoCoupleQuiz.Core.Models
@using PoCoupleQuiz.Core.Services
@inject ITeamService TeamService
@inject NavigationManager NavigationManager

<h3>Player Leaderboard</h3>

<div class="container mt-4">    @if (_isLoading)
    {
        <SkeletonLoader Type="leaderboard" />
    }
    else
    {
        @if (!_players.Any())
        {            <div class="alert alert-info text-center">
                <h4>No Players Yet!</h4>
                <p>Be the first to play and appear on the leaderboard!</p>
                <button class="btn btn-primary" @onclick="@(() => NavigationManager.NavigateTo("/"))">Start Playing</button>
            </div>
        }
        else
        {
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Player Name</th>
                            <th>Correct %</th>
                            <th>Questions Answered</th>
                            <th>Correct Answers</th>
                            <th>Last Played</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            var rank = 1;
                            foreach (var player in _players)
                            {
                                <tr>
                                    <td>@rank</td>
                                    <td>@player.Name</td>
                                    <td>@player.CorrectPercentage.ToString("F1")%</td>
                                    <td>@player.TotalQuestionsAnswered</td>
                                    <td>@player.CorrectAnswers</td>
                                    <td>@player.LastPlayed.ToLocalTime().ToString("g")</td>
                                </tr>
                                rank++;
                            }
                        }
                    </tbody>                </table>
            </div>
        }
    }
</div>

@code {
    private IEnumerable<Team> _players = Array.Empty<Team>();
    private bool _isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            _isLoading = true;
            var allPlayers = await TeamService.GetAllTeamsAsync();
            _players = allPlayers
                .Where(t => t.TotalQuestionsAnswered > 0)
                .OrderByDescending(t => t.CorrectPercentage)
                .ThenByDescending(t => t.TotalQuestionsAnswered)
                .Take(10)
                .ToList();
        }        catch (Exception)
        {
            // Handle error - could add error state here
            _players = Array.Empty<Team>();
        }
        finally
        {
            _isLoading = false;
            StateHasChanged();
        }
    }
}
name: pocouplequiz
services:
  api:
    project: PoCoupleQuiz.Server
    language: dotnet
    host: appservice
    hooks:
      prepackage:
        windows:
          shell: pwsh
          run: dotnet publish -c Release
        posix:
          shell: bash
          run: dotnet publish -c Release
    env:
      AZURE_OPENAI_ENDPOINT: ${AZURE_OPENAI_ENDPOINT}
      AZURE_OPENAI_KEY: ${AZURE_OPENAI_KEY}
      AZURE_OPENAI_DEPLOYMENT_NAME: ${AZURE_OPENAI_DEPLOYMENT_NAME}
      AZURE_STORAGE_CONNECTION_STRING: ${AZURE_STORAGE_CONNECTION_STRING}
      APPLICATIONINSIGHTS_CONNECTION_STRING: ${APPLICATIONINSIGHTS_CONNECTION_STRING}

infra:
  provider: bicep
  path: infra
  hooks:
    preprovision:
      windows:
        shell: pwsh
        run: az bicep install
      posix:
        shell: bash
        run: az bicep install 
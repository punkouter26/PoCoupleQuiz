%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#6366f1', 'primaryTextColor': '#fff', 'primaryBorderColor': '#4f46e5', 'lineColor': '#8b5cf6', 'secondaryColor': '#f8fafc', 'tertiaryColor': '#e5e7eb'}}}%%
flowchart TB
    subgraph Client["üñ•Ô∏è Blazor WASM Client"]
        UI[("UI Components<br/>Pages & Shared")]
        ClientServices["Client Services<br/>(HTTP Wrappers)"]
        GameState["GameStateService<br/>(Scoped State)"]
    end

    subgraph Server["üåê ASP.NET Core Server"]
        Controllers["API Controllers"]
        CoreServices["Core Services"]
        Validators["Validators"]
    end

    subgraph Azure["‚òÅÔ∏è Azure Cloud"]
        TableStorage[("Azure Table Storage<br/>Teams, GameHistory")]
        OpenAI["Azure OpenAI<br/>GPT-4o"]
        AppInsights["Application Insights<br/>Telemetry"]
        KeyVault["Key Vault<br/>Secrets"]
    end

    %% Client Flow
    UI -->|"User Interaction"| ClientServices
    ClientServices -->|"State Updates"| GameState
    GameState -->|"Render Updates"| UI

    %% Client to Server
    ClientServices -->|"HTTPS POST/GET"| Controllers

    %% Server Processing
    Controllers -->|"Validate Input"| Validators
    Controllers -->|"Business Logic"| CoreServices

    %% Server to Azure
    CoreServices -->|"Store/Retrieve<br/>Teams & History"| TableStorage
    CoreServices -->|"Generate Questions<br/>Check Similarity"| OpenAI
    CoreServices -->|"Structured Logs<br/>Custom Metrics"| AppInsights
    Server -->|"Load Secrets<br/>on Startup"| KeyVault

    %% Telemetry
    Client -.->|"Client Telemetry"| AppInsights

    classDef clientClass fill:#6366f1,stroke:#4f46e5,color:#fff
    classDef serverClass fill:#10b981,stroke:#059669,color:#fff
    classDef azureClass fill:#f59e0b,stroke:#d97706,color:#fff
    classDef storageClass fill:#3b82f6,stroke:#2563eb,color:#fff

    class UI,ClientServices,GameState clientClass
    class Controllers,CoreServices,Validators serverClass
    class OpenAI,AppInsights,KeyVault azureClass
    class TableStorage storageClass

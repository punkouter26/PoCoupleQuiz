%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#ef4444', 'primaryTextColor': '#fff', 'primaryBorderColor': '#dc2626', 'lineColor': '#f97316', 'secondaryColor': '#fef3c7', 'tertiaryColor': '#fee2e2'}}}%%
flowchart TB
    subgraph Coupling["üçù Dependency Coupling Analysis"]
        direction TB
        
        subgraph HighCoupling["üî¥ High Coupling (Potential Bottlenecks)"]
            GameStateService["GameStateService<br/>‚ö†Ô∏è Central State Hub"]
            AzureOpenAI["AzureOpenAIQuestionService<br/>‚ö†Ô∏è External API Dependency"]
            AzureTableStorage["AzureTableTeamService<br/>‚ö†Ô∏è Single Storage Provider"]
        end
        
        subgraph MediumCoupling["üü° Medium Coupling"]
            GamePage["Game.razor<br/>Orchestrates gameplay"]
            HttpQuestionService["HttpQuestionService<br/>Server proxy"]
            HttpTeamService["HttpTeamService<br/>Server proxy"]
        end
        
        subgraph LowCoupling["üü¢ Low Coupling (Good)"]
            Validators["TeamNameValidator<br/>Pure function"]
            Models["Core Models<br/>No dependencies"]
            SharedComponents["Shared Components<br/>UI only"]
        end
    end

    %% High coupling connections (red - bottleneck risk)
    GamePage -->|"7 method calls"| GameStateService
    GamePage -->|"3 API calls"| HttpQuestionService
    GamePage -->|"4 API calls"| HttpTeamService
    
    HttpQuestionService -->|"HTTP"| QuestionsController
    HttpTeamService -->|"HTTP"| TeamsController
    
    QuestionsController -->|"All questions"| AzureOpenAI
    TeamsController -->|"All data"| AzureTableStorage
    
    %% Medium coupling (orange)
    GameStateService -->|"State reads"| GamePage
    
    %% External dependencies (yellow - latency risk)
    AzureOpenAI -.->|"üåê External API<br/>~500ms latency"| OpenAIEndpoint["Azure OpenAI<br/>GPT-4o"]
    AzureTableStorage -.->|"üåê External Storage<br/>~50ms latency"| TableStorageEndpoint["Azure Table<br/>Storage"]

    subgraph Metrics["üìä Coupling Metrics"]
        M1["GameStateService: 7 dependents"]
        M2["AzureOpenAI: 1 external, 2 internal"]
        M3["Storage: Single point of failure"]
    end

    classDef highRisk fill:#ef4444,stroke:#dc2626,color:#fff
    classDef medRisk fill:#f97316,stroke:#ea580c,color:#fff
    classDef lowRisk fill:#22c55e,stroke:#16a34a,color:#fff
    classDef external fill:#6366f1,stroke:#4f46e5,color:#fff

    class GameStateService,AzureOpenAI,AzureTableStorage highRisk
    class GamePage,HttpQuestionService,HttpTeamService,QuestionsController,TeamsController medRisk
    class Validators,Models,SharedComponents lowRisk
    class OpenAIEndpoint,TableStorageEndpoint external
